---
Title: Exercise 10: Vulnerability Scanning with Nmap NSE
Objective: Leverage the Nmap Scripting Engine (NSE) to perform basic vulnerability scanning, identifying common misconfigurations, known vulnerabilities, and informational disclosures on target systems.
Estimated Time: 30-60 minutes
Tools Needed:
*   Nmap (Network Mapper) - Download from [nmap.org](https://nmap.org/download.html)
Setup Instructions:
1.  Ensure Nmap is installed and accessible from your terminal.
2.  Identify a target IP address or hostname. For this exercise, use a controlled lab environment with known vulnerable services (e.g., Metasploitable 2 or 3) or `scanme.nmap.org` for informational scripts. **Do NOT perform vulnerability scans on systems you do not own or have explicit permission to scan.**
---

## Steps

1.  **Explore Vulnerability-Related Scripts**
    *   Nmap's NSE includes a `vuln` category for scripts that detect various vulnerabilities.
    *   You can list them (and other categories) in your Nmap installation directory (e.g., `/usr/share/nmap/scripts/` on Linux) or online at [nmap.org/nsedoc/categories/vuln.html](https://nmap.org/nsedoc/categories/vuln.html).
    *   *Observation:* Notice scripts like `smb-vuln-ms17-010`, `ssl-heartbleed`, `http-enum`, etc.

2.  **Run Scripts from the 'vuln' Category**
    *   Open a terminal.
    *   Run a scan against your target, including the `vuln` script category:
        ```bash
        sudo nmap -sV --script=vuln [TargetIP]
        ```
    *   *Explanation:* The `-sV` flag is included to ensure service version detection occurs, as many vulnerability scripts rely on knowing the service first. The `--script=vuln` flag tells Nmap to execute all scripts in the 'vuln' category.

3.  **Run Specific Vulnerability Scripts**
    *   Sometimes you want to check for a very specific vulnerability. For example, to check for common HTTP vulnerabilities, you might run scripts from the `http-enum` or `http-vuln` families.
    *   For a target that might have web services (like `scanme.nmap.org`):
        ```bash
        sudo nmap -sV --script "http-enum,http-vuln*" [TargetIP]
        ```
    *   *Explanation:* You can use wildcards (`*`) to include multiple scripts matching a pattern. `http-enum` attempts to find common web applications and directories, while `http-vuln*` includes scripts specifically looking for HTTP-related vulnerabilities.

4.  **Analyze Vulnerability Scan Output**
    *   Review the output for any `VULNERABLE` entries or informational disclosures.
    *   *Observation:* Pay attention to the details provided by the scripts, as they often include CVE IDs, descriptions, and sometimes even links to advisories.

## Expected Output

```
Starting Nmap 7.94 ( https://nmap.org ) at 2024-02-24 13:00 EST
Nmap scan report for scanme.nmap.org (45.33.32.156)
Host is up (0.050s latency).
Not shown: 995 closed tcp ports (reset)
PORT      STATE    SERVICE      VERSION
22/tcp    open     ssh          OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 11:22:33:44:55:66:77:88:99:00 (DSA)
|_  2048 AA:BB:CC:DD:EE:FF:11:22:33:44 (RSA)
80/tcp    open     http         Apache httpd 2.4.7 ((Ubuntu))
|_http-enum: 
|   /robots.txt
|   /sitemap.xml
|_  /admin/ (Disallowed by robots.txt)
|_http-title: Go ahead and ScanMe!
9929/tcp  open     nping-echo   Nping echo
31337/tcp open     Elite

Nmap done: 1 IP address (1 host up) scanned in 35.50 seconds
```
![Expected output](images/exercise-10-output.png)

## Reflection Questions

1.  How do NSE scripts enhance Nmap's capability beyond simple port and service detection for vulnerability assessment?
2.  What are the limitations of using Nmap's NSE for vulnerability scanning compared to dedicated vulnerability scanners (e.g., Nessus, OpenVAS)?
3.  Why is it crucial to run vulnerability scans on a controlled environment or with explicit permission, especially when using scripts from the `vuln` category?

## Next Steps

*   [Exercise 11: Adjust Timing Templates with Nmap (-T)](../nmap/11-timing-templates.md)
*   Further reading: [Nmap Scripting Engine Categories](https://nmap.org/book/nse-categories.html) and [Nmap Script Reference](https://nmap.org/nsedoc/)

## Hints / Troubleshooting

*   **Permissions:** Always run vulnerability scans with `sudo` or as Administrator for best results and to avoid permission issues with scripts.
*   **False Positives/Negatives:** Nmap scripts can sometimes produce false positives or miss vulnerabilities. Always cross-reference with other tools and manual verification.
*   **Network Impact:** Vulnerability scripts can be noisy and intrusive. Monitor network traffic during scans and be prepared for potential disruptions on target systems.
*   **Updates:** Keep your Nmap installation and NSE scripts updated (`nmap --script-updatedb`) to ensure you have the latest vulnerability checks.
